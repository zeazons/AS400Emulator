{"ast":null,"code":"var _jsxFileName = \"/Users/jutawuth/git/emulator/src/components/Emulator/index.jsx\";\nimport React, { Component } from \"react\";\nimport $ from \"jquery\";\nimport \"../../css/style.css\";\n\nclass Emulator extends Component {\n  constructor(props) {\n    super(props);\n\n    this.getHighlightDefault = (rowSize, colSize) => {\n      let textHighlight = \"\";\n\n      for (let i = 0; i < rowSize; i += 1) {\n        for (let j = 0; j < colSize; j += 1) {\n          textHighlight += \".\";\n        }\n\n        textHighlight += \"\\n\";\n      }\n\n      return textHighlight;\n    };\n\n    this.getIndexByRowCol = (row, colSize) => (row - 1) * 80 + colSize + row - 2;\n\n    this.setSelectionRange = (elStr, selectionStart, selectionEnd) => {\n      const elScreen = $(`.${elStr}.as400-screen`)[0];\n      let start = selectionStart;\n      let end = selectionEnd;\n      start -= 1;\n      end -= 1; // elScreen.focus();\n\n      if (elScreen.setSelectionRange) {\n        elScreen.setSelectionRange(start, end);\n      } else if (elScreen.createTextRange) {\n        const range = elScreen.createTextRange();\n        range.collapse(true);\n        range.moveEnd(\"character\", end);\n        range.moveStart(\"character\", start);\n        range.select();\n      }\n    };\n\n    this.initScreen = (elStr, rowSize, colSize) => {\n      const elScreen = $(`.${elStr}.as400-screen`);\n      elScreen.attr(\"rows\", rowSize);\n      elScreen.attr(\"cols\", colSize);\n      const elScreenTemp = $(`.${elStr}.as400-screen-temp`);\n      elScreenTemp.attr(\"rows\", rowSize);\n      elScreenTemp.attr(\"cols\", colSize);\n      const elStyle = $(`.${elStr}.as400-style`);\n      elStyle.attr(\"rows\", rowSize);\n      elStyle.attr(\"cols\", colSize);\n      const elHighlight = $(`.${elStr}.as400-highlight`);\n      elHighlight.html(this.getHighlightDefault(rowSize, colSize));\n    };\n\n    this.setAs400Screen = (elStr, data) => {\n      const elScreen = $(`.${elStr}.as400-screen`);\n      elScreen.val(data);\n    };\n\n    this.setAs400Style = (elStr, text, styleParams) => {\n      const elStyle = $(`.${elStr}.as400-style`);\n      let style = styleParams; //   style = `..................................RRRRRRRRRRRRR.................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // .........................................................UUUUUUUUUU.............\\n\n      // .........................................................HHHHHHHHHH.............\\n\n      // .........................................................UUUUUUUUUU.............\\n\n      // .........................................................UUUUUUUUUU.............\\n\n      // .........................................................UUUUUUUUUU.............\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................\\n\n      // ................................................................................`;\n\n      console.log(\"styleParams: \", styleParams);\n      style = style.split(\"\\n\").join(\"\");\n      let textStyle = \"\";\n\n      for (let i = 0; i < text.length - 1; i += 1) {\n        const character = text[i];\n        const styleCharacter = style[i];\n\n        if (styleCharacter !== \".\" && !$.isEmptyObject(styleCharacter)) {\n          console.log(\"styleCharacter: \", styleCharacter);\n          textStyle += character.replace(character, `<as400-${styleCharacter.toLowerCase()}-style>$&</as400-${styleCharacter.toLowerCase()}-style>`);\n        } else {\n          textStyle += character;\n        }\n      }\n\n      $(elStyle).html(textStyle);\n    };\n\n    this.clearHighlight = (elStr, markType) => {\n      const elHighlight = $(`.${elStr}.as400-highlight`);\n      let newHighlight = elHighlight.html();\n      newHighlight = newHighlight.replace(`<as400-${markType}>`, \"\").replace(`</as400-${markType}>`, \"\");\n      elHighlight.html(newHighlight);\n    };\n\n    this.getAS400Cursor = posStr => {\n      const posArr = posStr.split(\",\");\n      return {\n        row: parseInt(posArr[0]),\n        col: parseInt(posArr[1])\n      };\n    };\n\n    this.setAS400Cursor = (elStr, data) => {\n      const pos = this.getAS400Cursor(data);\n      const index = this.getIndexByRowCol(pos.row, pos.col);\n      this.setSelectionRange(elStr, index, index);\n    };\n\n    this.convertRowColNumber = posStr => {\n      const posArr = posStr.trim().split(\",\");\n      return {\n        row: posArr[0],\n        col: posArr[1]\n      };\n    };\n\n    this.getRowNumberByIndex = (elStr, index) => {\n      const elScreen = $(`.${elStr}.as400-screen`);\n      return elScreen.val().substr(0, index).split(\"\\n\").length - 1;\n    };\n\n    this.getColNumberByIndex = (elStr, index, colSize) => {\n      const row = this.getRowNumberByIndex(elStr, index);\n      const col = (index - row) % colSize;\n\n      if (index === colSize * (row + 1) + row) {\n        return colSize;\n      }\n\n      return col;\n    };\n\n    this.setIndexByRowCol = (elStr, row, col) => {\n      const index = this.getIndexByRowCol(row, col);\n      this.setSelectionRange(elStr, index, index);\n    };\n\n    this.getStartSelection = (elStr, colSize) => {\n      const elScreen = $(`.${elStr}.as400-screen`);\n      const startIndex = elScreen.prop(\"selectionStart\");\n      const rowSelectionStartIndex = this.getRowNumberByIndex(elStr, startIndex) + 1;\n      const colSelectionStartIndex = this.getColNumberByIndex(elStr, startIndex, colSize) + 1;\n      return {\n        row: rowSelectionStartIndex,\n        col: colSelectionStartIndex\n      };\n    };\n\n    this.getEndSelection = (elStr, colSize) => {\n      const elScreen = $(`.${elStr}.as400-screen`);\n      const endIndex = elScreen.prop(\"selectionEnd\");\n      const rowSelectionEndIndex = this.getRowNumberByIndex(elStr, endIndex) + 1;\n      const colSelectionEndIndex = this.getColNumberByIndex(elStr, endIndex, colSize) + 1;\n      return {\n        row: rowSelectionEndIndex,\n        col: colSelectionEndIndex\n      };\n    };\n\n    this.getSelectionRange = (elStr, selectionStart, selectionEnd) => {\n      const elScreen = $(`.${elStr}.as400-screen`);\n\n      if (selectionStart !== selectionEnd) {\n        // selectionStart -= 1;\n        const selection = elScreen.val().substring(selectionStart, selectionEnd);\n        return selection;\n      }\n\n      return \"\";\n    };\n\n    const id = props.id;\n    this.state = {\n      id: id\n    };\n  }\n\n  componentDidMount() {\n    const data = this.props.data;\n    const _data$screen = data.screen,\n          rows = _data$screen.rows,\n          cols = _data$screen.cols;\n    const text = data.Text;\n    const style = data.Style;\n    const cursor = data.Cursor;\n    this.initScreen(this.props.id, rows, cols);\n    this.setAs400Screen(this.props.id, text);\n    this.setAs400Style(this.props.id, text, style);\n    this.setAS400Cursor(this.props.id, cursor);\n  }\n\n  render() {\n    const id = this.props.id;\n    return React.createElement(\"div\", {\n      className: \"as400-container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"screen\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: `${id} as400-highlight`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: `${id} as400-style`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248\n      },\n      __self: this\n    }), React.createElement(\"textarea\", {\n      className: `${id} as400-screen`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249\n      },\n      __self: this\n    }), React.createElement(\"textarea\", {\n      className: `${id} as400-screen-temp`,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250\n      },\n      __self: this\n    })));\n  }\n\n}\n\nexport default Emulator;","map":{"version":3,"sources":["/Users/jutawuth/git/emulator/src/components/Emulator/index.jsx"],"names":["React","Component","$","Emulator","constructor","props","getHighlightDefault","rowSize","colSize","textHighlight","i","j","getIndexByRowCol","row","setSelectionRange","elStr","selectionStart","selectionEnd","elScreen","start","end","createTextRange","range","collapse","moveEnd","moveStart","select","initScreen","attr","elScreenTemp","elStyle","elHighlight","html","setAs400Screen","data","val","setAs400Style","text","styleParams","style","console","log","split","join","textStyle","length","character","styleCharacter","isEmptyObject","replace","toLowerCase","clearHighlight","markType","newHighlight","getAS400Cursor","posStr","posArr","parseInt","col","setAS400Cursor","pos","index","convertRowColNumber","trim","getRowNumberByIndex","substr","getColNumberByIndex","setIndexByRowCol","getStartSelection","startIndex","prop","rowSelectionStartIndex","colSelectionStartIndex","getEndSelection","endIndex","rowSelectionEndIndex","colSelectionEndIndex","getSelectionRange","selection","substring","id","state","componentDidMount","screen","rows","cols","Text","Style","cursor","Cursor","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport $ from \"jquery\";\n\nimport \"../../css/style.css\";\n\nclass Emulator extends Component {\n  constructor(props) {\n    super(props);\n\n    const { id } = props;\n    this.state = {\n      id: id\n    };\n  }\n\n  componentDidMount() {\n    const data = this.props.data;\n\n    const { rows, cols } = data.screen;\n    const text = data.Text;\n    const style = data.Style;\n    const cursor = data.Cursor;\n\n    this.initScreen(this.props.id, rows, cols);\n    this.setAs400Screen(this.props.id, text);\n    this.setAs400Style(this.props.id, text, style);\n    this.setAS400Cursor(this.props.id, cursor);\n  }\n\n  getHighlightDefault = (rowSize, colSize) => {\n    let textHighlight = \"\";\n    for (let i = 0; i < rowSize; i += 1) {\n      for (let j = 0; j < colSize; j += 1) {\n        textHighlight += \".\";\n      }\n      textHighlight += \"\\n\";\n    }\n    return textHighlight;\n  };\n\n  getIndexByRowCol = (row, colSize) => (row - 1) * 80 + colSize + row - 2;\n\n  setSelectionRange = (elStr, selectionStart, selectionEnd) => {\n    const elScreen = $(`.${elStr}.as400-screen`)[0];\n\n    let start = selectionStart;\n    let end = selectionEnd;\n\n    start -= 1;\n    end -= 1;\n\n    // elScreen.focus();\n    if (elScreen.setSelectionRange) {\n      elScreen.setSelectionRange(start, end);\n    } else if (elScreen.createTextRange) {\n      const range = elScreen.createTextRange();\n      range.collapse(true);\n      range.moveEnd(\"character\", end);\n      range.moveStart(\"character\", start);\n      range.select();\n    }\n  };\n\n  initScreen = (elStr, rowSize, colSize) => {\n    const elScreen = $(`.${elStr}.as400-screen`);\n    elScreen.attr(\"rows\", rowSize);\n    elScreen.attr(\"cols\", colSize);\n\n    const elScreenTemp = $(`.${elStr}.as400-screen-temp`);\n    elScreenTemp.attr(\"rows\", rowSize);\n    elScreenTemp.attr(\"cols\", colSize);\n\n    const elStyle = $(`.${elStr}.as400-style`);\n    elStyle.attr(\"rows\", rowSize);\n    elStyle.attr(\"cols\", colSize);\n\n    const elHighlight = $(`.${elStr}.as400-highlight`);\n    elHighlight.html(this.getHighlightDefault(rowSize, colSize));\n  };\n\n  setAs400Screen = (elStr, data) => {\n    const elScreen = $(`.${elStr}.as400-screen`);\n    elScreen.val(data);\n  };\n\n  setAs400Style = (elStr, text, styleParams) => {\n    const elStyle = $(`.${elStr}.as400-style`);\n\n    let style = styleParams;\n    //   style = `..................................RRRRRRRRRRRRR.................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // .........................................................UUUUUUUUUU.............\\n\n    // .........................................................HHHHHHHHHH.............\\n\n    // .........................................................UUUUUUUUUU.............\\n\n    // .........................................................UUUUUUUUUU.............\\n\n    // .........................................................UUUUUUUUUU.............\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................\\n\n    // ................................................................................`;\n\n    console.log(\"styleParams: \", styleParams);\n\n    style = style.split(\"\\n\").join(\"\");\n\n    let textStyle = \"\";\n    for (let i = 0; i < text.length - 1; i += 1) {\n      const character = text[i];\n      const styleCharacter = style[i];\n\n      if (styleCharacter !== \".\" && !$.isEmptyObject(styleCharacter)) {\n        console.log(\"styleCharacter: \", styleCharacter);\n\n        textStyle += character.replace(\n          character,\n          `<as400-${styleCharacter.toLowerCase()}-style>$&</as400-${styleCharacter.toLowerCase()}-style>`\n        );\n      } else {\n        textStyle += character;\n      }\n    }\n\n    $(elStyle).html(textStyle);\n  };\n\n  clearHighlight = (elStr, markType) => {\n    const elHighlight = $(`.${elStr}.as400-highlight`);\n    let newHighlight = elHighlight.html();\n\n    newHighlight = newHighlight\n      .replace(`<as400-${markType}>`, \"\")\n      .replace(`</as400-${markType}>`, \"\");\n\n    elHighlight.html(newHighlight);\n  };\n\n  getAS400Cursor = posStr => {\n    const posArr = posStr.split(\",\");\n\n    return {\n      row: parseInt(posArr[0]),\n      col: parseInt(posArr[1])\n    };\n  };\n\n  setAS400Cursor = (elStr, data) => {\n    const pos = this.getAS400Cursor(data);\n\n    const index = this.getIndexByRowCol(pos.row, pos.col);\n\n    this.setSelectionRange(elStr, index, index);\n  };\n\n  convertRowColNumber = posStr => {\n    const posArr = posStr.trim().split(\",\");\n    return {\n      row: posArr[0],\n      col: posArr[1]\n    };\n  };\n\n  getRowNumberByIndex = (elStr, index) => {\n    const elScreen = $(`.${elStr}.as400-screen`);\n    return (\n      elScreen\n        .val()\n        .substr(0, index)\n        .split(\"\\n\").length - 1\n    );\n  };\n\n  getColNumberByIndex = (elStr, index, colSize) => {\n    const row = this.getRowNumberByIndex(elStr, index);\n    const col = (index - row) % colSize;\n\n    if (index === colSize * (row + 1) + row) {\n      return colSize;\n    }\n    return col;\n  };\n\n  setIndexByRowCol = (elStr, row, col) => {\n    const index = this.getIndexByRowCol(row, col);\n    this.setSelectionRange(elStr, index, index);\n  };\n\n  getStartSelection = (elStr, colSize) => {\n    const elScreen = $(`.${elStr}.as400-screen`);\n    const startIndex = elScreen.prop(\"selectionStart\");\n\n    const rowSelectionStartIndex =\n      this.getRowNumberByIndex(elStr, startIndex) + 1;\n    const colSelectionStartIndex =\n      this.getColNumberByIndex(elStr, startIndex, colSize) + 1;\n\n    return {\n      row: rowSelectionStartIndex,\n      col: colSelectionStartIndex\n    };\n  };\n\n  getEndSelection = (elStr, colSize) => {\n    const elScreen = $(`.${elStr}.as400-screen`);\n    const endIndex = elScreen.prop(\"selectionEnd\");\n    const rowSelectionEndIndex = this.getRowNumberByIndex(elStr, endIndex) + 1;\n    const colSelectionEndIndex =\n      this.getColNumberByIndex(elStr, endIndex, colSize) + 1;\n\n    return {\n      row: rowSelectionEndIndex,\n      col: colSelectionEndIndex\n    };\n  };\n\n  getSelectionRange = (elStr, selectionStart, selectionEnd) => {\n    const elScreen = $(`.${elStr}.as400-screen`);\n\n    if (selectionStart !== selectionEnd) {\n      // selectionStart -= 1;\n\n      const selection = elScreen.val().substring(selectionStart, selectionEnd);\n      return selection;\n    }\n    return \"\";\n  };\n\n  render() {\n    const { id } = this.props;\n\n    return (\n      <div className=\"as400-container\">\n        {/* <div className=\"as400-as400-area\"> */}\n        <div className=\"screen\">\n          <div className={`${id} as400-highlight`}></div>\n          <div className={`${id} as400-style`}></div>\n          <textarea className={`${id} as400-screen`}></textarea>\n          <textarea className={`${id} as400-screen-temp`}></textarea>\n        </div>\n        {/* </div> */}\n      </div>\n    );\n  }\n}\nexport default Emulator;\n"]},"metadata":{},"sourceType":"module"}