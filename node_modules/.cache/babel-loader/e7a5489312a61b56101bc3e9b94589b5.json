{"ast":null,"code":"import _objectSpread from \"/Users/jutawuth/git/emulator/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/jutawuth/git/emulator/src/components/ScreenMapping/index.jsx\";\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport $ from \"jquery\";\nimport _ from \"lodash\";\nimport Emulator from \"../Emulator/index\";\nimport EmulatorView from \"../Emulator/EmulatorView\";\nimport { getIndexByRowCol, getHighlightDefault, getSelectionRange, getStartSelection } from \"../Emulator/controler\";\nexport class ScreenMapping extends Emulator {\n  constructor(_props) {\n    super(_props);\n\n    this.markAllCheckString = markListData => {\n      this.clearAllMarkChackString(this.state.id);\n      this.setState({\n        markList: markListData\n      });\n      const elHighlight = $(`.${this.state.id}.as400-highlight`);\n      const text = elHighlight[0].innerHTML;\n      let textHighlight = \"\";\n\n      for (let i = 0; i < text.length; i += 1) {\n        if (!_.isEmpty(markListData.mark1) && i === getIndexByRowCol(markListData.mark1.row, markListData.mark1.col)) {\n          if (markListData.mark1.text.length < 2) {\n            textHighlight += `<as400-mark-1>${text[i]}</as400-mark-1>`;\n          } else {\n            textHighlight += `<as400-mark-1>${text[i]}`;\n          }\n        } else if (!_.isEmpty(markListData.mark1) && i === getIndexByRowCol(markListData.mark1.row, markListData.mark1.col) + markListData.mark1.text.length - 1) {\n          textHighlight += `${text[i]}</as400-mark-1>`;\n        } else if (!_.isEmpty(markListData.mark2) && i === getIndexByRowCol(markListData.mark2.row, markListData.mark2.col)) {\n          if (markListData.mark2.text.length < 2) {\n            textHighlight += `<as400-mark-2>${text[i]}</as400-mark-2>`;\n          } else {\n            textHighlight += `<as400-mark-2>${text[i]}`;\n          }\n        } else if (!_.isEmpty(markListData.mark2) && i === getIndexByRowCol(markListData.mark2.row, markListData.mark2.col) + markListData.mark2.text.length - 1) {\n          textHighlight += `${text[i]}</as400-mark-2>`;\n        } else if (!_.isEmpty(markListData.mark3) && i === getIndexByRowCol(markListData.mark3.row, markListData.mark3.col)) {\n          if (markListData.mark3.text.length < 2) {\n            textHighlight += `<as400-mark-3>${text[i]}</as400-mark-3>`;\n          } else {\n            textHighlight += `<as400-mark-3>${text[i]}`;\n          }\n        } else if (!_.isEmpty(markListData.mark3) && i === getIndexByRowCol(markListData.mark3.row, markListData.mark3.col) + markListData.mark3.text.length - 1) {\n          textHighlight += `${text[i]}</as400-mark-3>`;\n        } else {\n          textHighlight += text[i];\n        }\n      }\n\n      elHighlight.html(textHighlight);\n    };\n\n    this.clearAllMarkChackString = elStr => {\n      const elHighlight = $(`.${elStr}.as400-highlight`);\n      elHighlight.html(getHighlightDefault(24, 80));\n      this.setState({\n        markList: {}\n      });\n    };\n\n    this.markStringChackString = (markType, highlight) => {\n      let newMarkList = \"\";\n      const markList = this.state.markList;\n      newMarkList = _objectSpread({}, markList, {\n        [markType.replace(\"-\", \"\")]: highlight\n      });\n      this.setState({\n        markList: newMarkList\n      });\n      this.markAllCheckString(newMarkList);\n    };\n\n    this.clearMarkString = markType => {\n      let newMarkList = \"\";\n      const markList = this.state.markList;\n      const markData = {};\n      newMarkList = _objectSpread({}, markList, {\n        [markType.replace(\"-\", \"\")]: markData\n      });\n      this.setState({\n        markList: newMarkList\n      });\n      this.markAllCheckString(newMarkList);\n    };\n\n    this.onMouseUp = () => {\n      const elScreen = $(`.${props.name}.as400-screen`);\n      elScreen.mouseup(() => {\n        // console.log(`| ========== ${event.type} ========== | `);\n        const startSelection = getStartSelection(props.name, colSize);\n        const endSelection = getEndSelection(props.name, colSize);\n        const flag = \"field\"; // const flag = 'list';\n\n        if (flag === \"list\") {\n          const selectionStart = getIndexByRowCol(startSelection.row, 0) + 1;\n          const selectionEnd = getIndexByRowCol(endSelection.row, colSize) + 2;\n          setSelectionRange(props.name, selectionStart, selectionEnd);\n        }\n      });\n    };\n\n    this.onKeyDown = () => {\n      const elScreen = $(`.${props.name}.as400-screen`); // const data = props.as400ScreenData;\n      // const colSize = data.DATA.screen.cols;\n\n      elScreen.keydown(event => {\n        // console.log(`| ========== ${event.type} ========== |`);\n        if (event.keyCode === 9 || event.keyCode > 111 && event.keyCode !== 123) {\n          event.preventDefault();\n        }\n\n        const _AS400ScreenConfig = AS400ScreenConfig,\n              url = _AS400ScreenConfig.url;\n        let eventKey = event.key;\n        const selected = getStartSelection(props.name, colSize);\n\n        if (event.keyCode >= 8 && event.keyCode < 48) {\n          eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n        }\n\n        const dataForApi = {\n          HEADER: {\n            tokenId: \"EWI112233445566\",\n            requestId: \"ABC123456789\",\n            deviceId: \"UUID9988776655\" // requestCount: this.resultCount\n\n          },\n          DATA: {\n            Event: \"KEYDOWN\",\n            KeyValue: eventKey,\n            Cursor: `${selected.row},${selected.col}`\n          }\n        };\n        Axios({\n          method: \"post\",\n          url,\n          data: JSON.stringify(dataForApi),\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        }).then(response => {\n          // handle success\n          const data = response.data.DATA;\n          setAs400Screen(props.name, data.Text);\n          setAs400Style(props.name, data.Text, data.Style);\n          setAS400Cursor(props.name, data.Cursor);\n          clearAllMarkChackString(props.name);\n        }).catch(response => {\n          // handle error\n          console.log(`response: ${response}`);\n        });\n      });\n    };\n\n    this.onDoubleClick = () => {\n      const elScreen = $(`.${props.name}.as400-screen`);\n      elScreen.dblclick(event => {\n        // console.log(`| ========== ${event.type} ========== |`);\n        const url = AS400ScreenConfig.url.url;\n        let eventKey = event.key;\n\n        if (event.keyCode >= 8 && event.keyCode < 48) {\n          eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n        }\n\n        const selected = getStartSelection(props.name, colSize);\n        const dataForApi = {\n          HEADER: {\n            tokenId: \"EWI112233445566\",\n            requestId: \"ABC123456789\",\n            deviceId: \"UUID9988776655\" // requestCount: this.resultCount\n\n          },\n          DATA: {\n            Event: \"SELECTION\",\n            KeyValue: eventKey,\n            Cursor: `${selected.row},${selected.col}`\n          }\n        };\n        Axios({\n          method: \"post\",\n          url,\n          data: JSON.stringify(dataForApi),\n          headers: {\n            \"Content-Type\": \"application/json\"\n          }\n        }).then(response => {\n          // handle success\n          const data = response.data.DATA;\n          setAs400Screen(props.name, data.Text);\n          setAs400Style(props.name, data.Text, data.Style);\n          setAS400Cursor(props.name, data.Cursor); // clearAllMarkChackString(props.name);\n\n          const fields = data.Fields;\n          let selection = null;\n          const index = getAS400Cursor(data.Cursor);\n          fields.forEach(f => {\n            if (Math.abs(f.EndRow - f.StartRow) === 0) {\n              if (index.col >= f.StartCol && index.col <= f.EndCol && f.StartRow === index.row) {\n                selection = f;\n              }\n            }\n          });\n          const selectionStart = getIndexByRowCol(selection.StartRow, selection.StartCol);\n          const selectionEnd = getIndexByRowCol(selection.EndRow, selection.EndCol);\n          setSelectionRange(props.name, selectionStart, selectionEnd);\n        }).catch(response => {\n          // handle error\n          console.log(`response: ${response}`);\n        });\n      });\n    };\n\n    this.onSelect = (id, colSize) => {\n      const elScreen = $(`.${id}.as400-screen`);\n      elScreen.select(event => {\n        // console.log(`| ========== ${event.type} ========== |`);\n        const start = event.target.selectionStart;\n        const end = event.target.selectionEnd;\n        const startPosition = getStartSelection(id, colSize);\n        this.setState({\n          lastSelection: {\n            text: getSelectionRange(id, start, end),\n            row: startPosition.row,\n            col: startPosition.col\n          }\n        });\n      });\n    };\n\n    this.getHighlight = markType => {\n      return this.state.markList[markType.replace(\"-\", \"\")];\n    };\n\n    this.setHighlight = (markType, highlight) => {\n      this.markStringChackString(markType, highlight);\n    };\n\n    this.clearHighlight = markType => {\n      return this.clearMarkString(markType);\n    };\n\n    this.getHighlightList = () => {\n      return this.state.markList;\n    };\n\n    this.setHighlightList = highlightList => {\n      this.markAllCheckString(highlightList);\n    };\n\n    this.clearHighlightList = () => {\n      this.clearAllMarkChackString(this.props.id);\n    };\n\n    this.getLastSelection = () => {\n      return this.state.lastSelection;\n    };\n\n    this.state = {\n      id: _props.id,\n      markList: _props.highlightList,\n      lastSelection: {\n        startIndex: 0,\n        endIndex: 0\n      }\n    };\n  }\n\n  componentDidMount(...args) {\n    super.componentDidMount.apply(this, args);\n    this.markAllCheckString(this.props.highlight);\n    const _this$props = this.props,\n          id = _this$props.id,\n          cols = _this$props.cols;\n    this.onSelect(id, cols);\n    this.onMouseUp();\n    this.onKeyDown();\n    this.onDoubleClick();\n  }\n\n  render() {\n    const _this$props2 = this.props,\n          id = _this$props2.id,\n          readOnly = _this$props2.readOnly;\n    return React.createElement(EmulatorView, {\n      id: id,\n      readOnly: readOnly,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354\n      },\n      __self: this\n    });\n  } // Set default props\n\n\n}\nScreenMapping.defaultProps = {\n  highlight: {}\n};\nScreenMapping.propTypes = {\n  highlightList: PropTypes.object\n};\nexport default ScreenMapping;","map":{"version":3,"sources":["/Users/jutawuth/git/emulator/src/components/ScreenMapping/index.jsx"],"names":["React","PropTypes","$","_","Emulator","EmulatorView","getIndexByRowCol","getHighlightDefault","getSelectionRange","getStartSelection","ScreenMapping","constructor","props","markAllCheckString","markListData","clearAllMarkChackString","state","id","setState","markList","elHighlight","text","innerHTML","textHighlight","i","length","isEmpty","mark1","row","col","mark2","mark3","html","elStr","markStringChackString","markType","highlight","newMarkList","replace","clearMarkString","markData","onMouseUp","elScreen","name","mouseup","startSelection","colSize","endSelection","getEndSelection","flag","selectionStart","selectionEnd","setSelectionRange","onKeyDown","keydown","event","keyCode","preventDefault","AS400ScreenConfig","url","eventKey","key","selected","toLowerCase","dataForApi","HEADER","tokenId","requestId","deviceId","DATA","Event","KeyValue","Cursor","Axios","method","data","JSON","stringify","headers","then","response","setAs400Screen","Text","setAs400Style","Style","setAS400Cursor","catch","console","log","onDoubleClick","dblclick","fields","Fields","selection","index","getAS400Cursor","forEach","f","Math","abs","EndRow","StartRow","StartCol","EndCol","onSelect","select","start","target","end","startPosition","lastSelection","getHighlight","setHighlight","clearHighlight","getHighlightList","setHighlightList","highlightList","clearHighlightList","getLastSelection","startIndex","endIndex","componentDidMount","args","apply","cols","render","readOnly","defaultProps","propTypes","object"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\n\nimport $ from \"jquery\";\nimport _ from \"lodash\";\n\nimport Emulator from \"../Emulator/index\";\nimport EmulatorView from \"../Emulator/EmulatorView\";\n\nimport {\n  getIndexByRowCol,\n  getHighlightDefault,\n  getSelectionRange,\n  getStartSelection\n} from \"../Emulator/controler\";\n\nexport class ScreenMapping extends Emulator {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      id: props.id,\n      markList: props.highlightList,\n      lastSelection: {\n        startIndex: 0,\n        endIndex: 0\n      }\n    };\n  }\n\n  componentDidMount(...args) {\n    super.componentDidMount.apply(this, args);\n    this.markAllCheckString(this.props.highlight);\n\n    const { id, cols } = this.props;\n    this.onSelect(id, cols);\n    this.onMouseUp();\n    this.onKeyDown();\n    this.onDoubleClick();\n  }\n\n  markAllCheckString = markListData => {\n    this.clearAllMarkChackString(this.state.id);\n    this.setState({\n      markList: markListData\n    });\n\n    const elHighlight = $(`.${this.state.id}.as400-highlight`);\n    const text = elHighlight[0].innerHTML;\n    let textHighlight = \"\";\n    for (let i = 0; i < text.length; i += 1) {\n      if (\n        !_.isEmpty(markListData.mark1) &&\n        i === getIndexByRowCol(markListData.mark1.row, markListData.mark1.col)\n      ) {\n        if (markListData.mark1.text.length < 2) {\n          textHighlight += `<as400-mark-1>${text[i]}</as400-mark-1>`;\n        } else {\n          textHighlight += `<as400-mark-1>${text[i]}`;\n        }\n      } else if (\n        !_.isEmpty(markListData.mark1) &&\n        i ===\n          getIndexByRowCol(markListData.mark1.row, markListData.mark1.col) +\n            markListData.mark1.text.length -\n            1\n      ) {\n        textHighlight += `${text[i]}</as400-mark-1>`;\n      } else if (\n        !_.isEmpty(markListData.mark2) &&\n        i === getIndexByRowCol(markListData.mark2.row, markListData.mark2.col)\n      ) {\n        if (markListData.mark2.text.length < 2) {\n          textHighlight += `<as400-mark-2>${text[i]}</as400-mark-2>`;\n        } else {\n          textHighlight += `<as400-mark-2>${text[i]}`;\n        }\n      } else if (\n        !_.isEmpty(markListData.mark2) &&\n        i ===\n          getIndexByRowCol(markListData.mark2.row, markListData.mark2.col) +\n            markListData.mark2.text.length -\n            1\n      ) {\n        textHighlight += `${text[i]}</as400-mark-2>`;\n      } else if (\n        !_.isEmpty(markListData.mark3) &&\n        i === getIndexByRowCol(markListData.mark3.row, markListData.mark3.col)\n      ) {\n        if (markListData.mark3.text.length < 2) {\n          textHighlight += `<as400-mark-3>${text[i]}</as400-mark-3>`;\n        } else {\n          textHighlight += `<as400-mark-3>${text[i]}`;\n        }\n      } else if (\n        !_.isEmpty(markListData.mark3) &&\n        i ===\n          getIndexByRowCol(markListData.mark3.row, markListData.mark3.col) +\n            markListData.mark3.text.length -\n            1\n      ) {\n        textHighlight += `${text[i]}</as400-mark-3>`;\n      } else {\n        textHighlight += text[i];\n      }\n    }\n\n    elHighlight.html(textHighlight);\n  };\n\n  clearAllMarkChackString = elStr => {\n    const elHighlight = $(`.${elStr}.as400-highlight`);\n    elHighlight.html(getHighlightDefault(24, 80));\n\n    this.setState({\n      markList: {}\n    });\n  };\n\n  markStringChackString = (markType, highlight) => {\n    let newMarkList = \"\";\n    const markList = this.state.markList;\n\n    newMarkList = {\n      ...markList,\n      [markType.replace(\"-\", \"\")]: highlight\n    };\n\n    this.setState({ markList: newMarkList });\n    this.markAllCheckString(newMarkList);\n  };\n\n  clearMarkString = markType => {\n    let newMarkList = \"\";\n    const markList = this.state.markList;\n    const markData = {};\n\n    newMarkList = {\n      ...markList,\n      [markType.replace(\"-\", \"\")]: markData\n    };\n\n    this.setState({ markList: newMarkList });\n    this.markAllCheckString(newMarkList);\n  };\n\n  onMouseUp = () => {\n    const elScreen = $(`.${props.name}.as400-screen`);\n\n    elScreen.mouseup(() => {\n      // console.log(`| ========== ${event.type} ========== | `);\n      const startSelection = getStartSelection(props.name, colSize);\n      const endSelection = getEndSelection(props.name, colSize);\n\n      const flag = \"field\";\n      // const flag = 'list';\n      if (flag === \"list\") {\n        const selectionStart = getIndexByRowCol(startSelection.row, 0) + 1;\n        const selectionEnd = getIndexByRowCol(endSelection.row, colSize) + 2;\n\n        setSelectionRange(props.name, selectionStart, selectionEnd);\n      }\n    });\n  };\n\n  onKeyDown = () => {\n    const elScreen = $(`.${props.name}.as400-screen`);\n\n    // const data = props.as400ScreenData;\n    // const colSize = data.DATA.screen.cols;\n\n    elScreen.keydown(event => {\n      // console.log(`| ========== ${event.type} ========== |`);\n      if (\n        event.keyCode === 9 ||\n        (event.keyCode > 111 && event.keyCode !== 123)\n      ) {\n        event.preventDefault();\n      }\n\n      const { url } = AS400ScreenConfig;\n      let eventKey = event.key;\n      const selected = getStartSelection(props.name, colSize);\n      if (event.keyCode >= 8 && event.keyCode < 48) {\n        eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n      }\n      const dataForApi = {\n        HEADER: {\n          tokenId: \"EWI112233445566\",\n          requestId: \"ABC123456789\",\n          deviceId: \"UUID9988776655\"\n          // requestCount: this.resultCount\n        },\n        DATA: {\n          Event: \"KEYDOWN\",\n          KeyValue: eventKey,\n          Cursor: `${selected.row},${selected.col}`\n        }\n      };\n\n      Axios({\n        method: \"post\",\n        url,\n        data: JSON.stringify(dataForApi),\n        headers: { \"Content-Type\": \"application/json\" }\n      })\n        .then(response => {\n          // handle success\n          const data = response.data.DATA;\n\n          setAs400Screen(props.name, data.Text);\n          setAs400Style(props.name, data.Text, data.Style);\n          setAS400Cursor(props.name, data.Cursor);\n\n          clearAllMarkChackString(props.name);\n        })\n        .catch(response => {\n          // handle error\n          console.log(`response: ${response}`);\n        });\n    });\n  };\n\n  onDoubleClick = () => {\n    const elScreen = $(`.${props.name}.as400-screen`);\n\n    elScreen.dblclick(event => {\n      // console.log(`| ========== ${event.type} ========== |`);\n\n      const { url } = AS400ScreenConfig.url;\n      let eventKey = event.key;\n      if (event.keyCode >= 8 && event.keyCode < 48) {\n        eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n      }\n      const selected = getStartSelection(props.name, colSize);\n      const dataForApi = {\n        HEADER: {\n          tokenId: \"EWI112233445566\",\n          requestId: \"ABC123456789\",\n          deviceId: \"UUID9988776655\"\n          // requestCount: this.resultCount\n        },\n        DATA: {\n          Event: \"SELECTION\",\n          KeyValue: eventKey,\n          Cursor: `${selected.row},${selected.col}`\n        }\n      };\n\n      Axios({\n        method: \"post\",\n        url,\n        data: JSON.stringify(dataForApi),\n        headers: { \"Content-Type\": \"application/json\" }\n      })\n        .then(response => {\n          // handle success\n          const data = response.data.DATA;\n\n          setAs400Screen(props.name, data.Text);\n          setAs400Style(props.name, data.Text, data.Style);\n          setAS400Cursor(props.name, data.Cursor);\n\n          // clearAllMarkChackString(props.name);\n\n          const fields = data.Fields;\n          let selection = null;\n\n          const index = getAS400Cursor(data.Cursor);\n          fields.forEach(f => {\n            if (Math.abs(f.EndRow - f.StartRow) === 0) {\n              if (\n                index.col >= f.StartCol &&\n                index.col <= f.EndCol &&\n                f.StartRow === index.row\n              ) {\n                selection = f;\n              }\n            }\n          });\n\n          const selectionStart = getIndexByRowCol(\n            selection.StartRow,\n            selection.StartCol\n          );\n          const selectionEnd = getIndexByRowCol(\n            selection.EndRow,\n            selection.EndCol\n          );\n\n          setSelectionRange(props.name, selectionStart, selectionEnd);\n        })\n        .catch(response => {\n          // handle error\n          console.log(`response: ${response}`);\n        });\n    });\n  };\n\n  onSelect = (id, colSize) => {\n    const elScreen = $(`.${id}.as400-screen`);\n\n    elScreen.select(event => {\n      // console.log(`| ========== ${event.type} ========== |`);\n      const start = event.target.selectionStart;\n      const end = event.target.selectionEnd;\n      const startPosition = getStartSelection(id, colSize);\n\n      this.setState({\n        lastSelection: {\n          text: getSelectionRange(id, start, end),\n          row: startPosition.row,\n          col: startPosition.col\n        }\n      });\n    });\n  };\n\n  /**\n   * ==================\n   *  provide function\n   * ==================\n   */\n  getHighlight = markType => {\n    return this.state.markList[markType.replace(\"-\", \"\")];\n  };\n\n  setHighlight = (markType, highlight) => {\n    this.markStringChackString(markType, highlight);\n  };\n\n  clearHighlight = markType => {\n    return this.clearMarkString(markType);\n  };\n\n  getHighlightList = () => {\n    return this.state.markList;\n  };\n\n  setHighlightList = highlightList => {\n    this.markAllCheckString(highlightList);\n  };\n\n  clearHighlightList = () => {\n    this.clearAllMarkChackString(this.props.id);\n  };\n\n  getLastSelection = () => {\n    return this.state.lastSelection;\n  };\n\n  render() {\n    const { id, readOnly } = this.props;\n    return <EmulatorView id={id} readOnly={readOnly} />;\n  }\n\n  // Set default props\n  static defaultProps = {\n    highlight: {}\n  };\n}\n\nScreenMapping.propTypes = {\n  highlightList: PropTypes.object\n};\n\nexport default ScreenMapping;\n"]},"metadata":{},"sourceType":"module"}