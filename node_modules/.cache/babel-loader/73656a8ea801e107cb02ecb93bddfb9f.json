{"ast":null,"code":"var _jsxFileName = \"/Users/jutawuth/Git/SSQUARE/Component-AS400-React/src/App.js\";\nimport React, { useRef } from \"react\";\nimport Axios from \"axios\";\nimport Emulator from \"./components/Emulator\";\nimport ScreenMapping from \"./components/ScreenMapping\";\nimport { setAs400Screen, setAs400Style, getAS400Cursor, setAS400Cursor, getIndexByRowCol, setSelectionRange, getStartSelection, getEndSelection } from \"./components/Emulator/controler\";\n\nfunction App() {\n  const smRef = useRef();\n  const MARK1 = \"mark-1\";\n  const data = {\n    HEADER: {\n      tokenId: \"EWI112233445566\",\n      requestId: \"ABC123456789\",\n      deviceId: \"UUID9988776655\"\n    },\n    DATA: {\n      screen: {\n        rows: 24,\n        cols: 80\n      },\n      Text: \"                                   Sign On                                      \\n                                               System  . . . . . :   S101CD3M   \\n                                               Subsystem . . . . :   QINTER     \\n                                               Display . . . . . :   QPADEV003R \\n                                                                                \\n                User  . . . . . . . . . . . . . .                               \\n                Password  . . . . . . . . . . . .                               \\n                Program/procedure . . . . . . . .                               \\n                Menu  . . . . . . . . . . . . . .                               \\n                Current library . . . . . . . . .                               \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                        (C) COPYRIGHT IBM CORP. 1980, 2005.     \",\n      Style: \".................................RRRRRRRRRRRRR..................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n.........................................................UUUUUUUUUU.............\\n.........................................................HHHHHHHHHH.............\\n.........................................................UUUUUUUUUU.............\\n.........................................................UUUUUUUUUU.............\\n.........................................................UUUUUUUUUU.............\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\",\n      Cursor: \"5,53\"\n    }\n  };\n  const id = \"flow2\";\n  const _data$DATA$screen = data.DATA.screen,\n        rows = _data$DATA$screen.rows,\n        cols = _data$DATA$screen.cols;\n  const _data$DATA = data.DATA,\n        text = _data$DATA.Text,\n        style = _data$DATA.Style,\n        cursor = _data$DATA.Cursor;\n  const highlightList = {\n    mark1: {\n      text: \"Sign On\",\n      row: 1,\n      col: 36\n    },\n    mark2: {\n      text: \"User\",\n      row: 6,\n      col: 17\n    },\n    mark3: {\n      text: \"(C) COPYRIGHT IBM CORP. 1980, 2005.\",\n      row: 24,\n      col: 41\n    }\n  };\n\n  const onDbllickHandler = event => {\n    // console.log(`| ========== ${event.type} ========== |`);\n    let eventKey = event.key;\n\n    if (event.keyCode >= 8 && event.keyCode < 48) {\n      eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n    }\n\n    const selected = getStartSelection(id, cols);\n    const dataForApi = {\n      HEADER: {\n        tokenId: \"EWI112233445566\",\n        requestId: \"ABC123456789\",\n        deviceId: \"UUID9988776655\" // requestCount: this.resultCount\n\n      },\n      DATA: {\n        Event: \"SELECTION\",\n        KeyValue: eventKey,\n        Cursor: `${selected.row},${selected.col}`\n      }\n    };\n    Axios({\n      method: \"post\",\n      url: \"http://localhost:8085/emulator\",\n      data: JSON.stringify(dataForApi),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(response => {\n      // handle success\n      const data = response.data.DATA;\n      setAs400Screen(id, data.Text);\n      setAs400Style(id, data.Text, data.Style);\n      setAS400Cursor(id, data.Cursor);\n      const fields = data.Fields;\n      let selection = null;\n      const index = getAS400Cursor(data.Cursor);\n      fields.forEach(f => {\n        if (Math.abs(f.EndRow - f.StartRow) === 0) {\n          if (index.col >= f.StartCol && index.col <= f.EndCol && f.StartRow === index.row) {\n            selection = f;\n          }\n        }\n      });\n      const selectionStart = getIndexByRowCol(selection.StartRow, selection.StartCol);\n      const selectionEnd = getIndexByRowCol(selection.EndRow, selection.EndCol);\n      setSelectionRange(id, selectionStart, selectionEnd);\n    }).catch(response => {\n      // handle error\n      console.log(`response: ${response}`);\n    });\n  };\n\n  const onMouseUpHandler = event => {\n    console.log(`| ========== ${event.type} ========== | `);\n\n    if (event.keyCode === 9 || event.keyCode > 111 && event.keyCode !== 123) {\n      event.preventDefault();\n    }\n\n    const url = this.state.url;\n    let eventKey = event.key;\n    const selected = getStartSelection(id, cols);\n\n    if (event.keyCode >= 8 && event.keyCode < 48) {\n      eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n    }\n\n    const dataForApi = {\n      HEADER: {\n        tokenId: \"EWI112233445566\",\n        requestId: \"ABC123456789\",\n        deviceId: \"UUID9988776655\" // requestCount: this.resultCount\n\n      },\n      DATA: {\n        Event: \"KEYDOWN\",\n        KeyValue: eventKey,\n        Cursor: `${selected.row},${selected.col}`\n      }\n    };\n    Axios({\n      method: \"post\",\n      url,\n      data: JSON.stringify(dataForApi),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(response => {\n      // handle success\n      const data = response.data.DATA;\n      setAs400Screen(id, data.Text);\n      setAs400Style(id, data.Text, data.Style);\n      setAS400Cursor(id, data.Cursor);\n      this.clearAllMarkChackString(id);\n    }).catch(response => {\n      // handle error\n      console.log(`response: ${response}`);\n    });\n  };\n\n  const onKeyDownHandler = event => {\n    console.log(`| ========== ${event.type} ========== | `);\n    const startSelection = getStartSelection(id, cols);\n    const endSelection = getEndSelection(id, cols);\n    const flag = \"field\"; // const flag = 'list';\n\n    if (flag === \"list\") {\n      const selectionStart = getIndexByRowCol(startSelection.row, 0) + 1;\n      const selectionEnd = getIndexByRowCol(endSelection.row, cols) + 2;\n      setSelectionRange(id, selectionStart, selectionEnd);\n    }\n  };\n\n  return React.createElement(\"div\", {\n    className: \"App\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201\n    },\n    __self: this\n  }, React.createElement(ScreenMapping, {\n    id: id,\n    ref: smRef,\n    rows: rows,\n    cols: cols,\n    text: text,\n    style: style,\n    cursor: cursor,\n    highlight: highlightList,\n    onDoubleClick: onDbllickHandler,\n    onMouseUp: onMouseUpHandler,\n    onKeyDown: onKeyDownHandler,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }), React.createElement(\"button\", {\n    onClick: () => smRef.current.setHighlightList(highlightList),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215\n    },\n    __self: this\n  }, \"highlight\"), React.createElement(\"button\", {\n    onClick: () => {\n      console.log(smRef.current.getHighlightList());\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218\n    },\n    __self: this\n  }, \"get mark\"), React.createElement(\"button\", {\n    onClick: () => smRef.current.clearHighlightList(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225\n    },\n    __self: this\n  }, \"clear\"), React.createElement(\"button\", {\n    onClick: () => {\n      const highlight = smRef.current.getLastSelection();\n      smRef.current.setHighlight(MARK1, highlight);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228\n    },\n    __self: this\n  }, \"mark 1\"), React.createElement(\"button\", {\n    onClick: () => {\n      console.log(smRef.current.getHighlight(MARK1));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236\n    },\n    __self: this\n  }, \"get mark 1\"), React.createElement(\"button\", {\n    onClick: () => {\n      smRef.current.clearHighlight(MARK1);\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243\n    },\n    __self: this\n  }, \"clear mark 1\")));\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/jutawuth/Git/SSQUARE/Component-AS400-React/src/App.js"],"names":["React","useRef","Axios","Emulator","ScreenMapping","setAs400Screen","setAs400Style","getAS400Cursor","setAS400Cursor","getIndexByRowCol","setSelectionRange","getStartSelection","getEndSelection","App","smRef","MARK1","data","HEADER","tokenId","requestId","deviceId","DATA","screen","rows","cols","Text","Style","Cursor","id","text","style","cursor","highlightList","mark1","row","col","mark2","mark3","onDbllickHandler","event","eventKey","key","keyCode","toLowerCase","selected","dataForApi","Event","KeyValue","method","url","JSON","stringify","headers","then","response","fields","Fields","selection","index","forEach","f","Math","abs","EndRow","StartRow","StartCol","EndCol","selectionStart","selectionEnd","catch","console","log","onMouseUpHandler","type","preventDefault","state","clearAllMarkChackString","onKeyDownHandler","startSelection","endSelection","flag","current","setHighlightList","getHighlightList","clearHighlightList","highlight","getLastSelection","setHighlight","getHighlight","clearHighlight"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,MAAhB,QAA8B,OAA9B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,OAAOC,QAAP,MAAqB,uBAArB;AACA,OAAOC,aAAP,MAA0B,4BAA1B;AAEA,SACEC,cADF,EAEEC,aAFF,EAGEC,cAHF,EAIEC,cAJF,EAKEC,gBALF,EAMEC,iBANF,EAOEC,iBAPF,EAQEC,eARF,QASO,iCATP;;AAWA,SAASC,GAAT,GAAe;AACb,QAAMC,KAAK,GAAGb,MAAM,EAApB;AACA,QAAMc,KAAK,GAAG,QAAd;AAEA,QAAMC,IAAI,GAAG;AACXC,IAAAA,MAAM,EAAE;AACNC,MAAAA,OAAO,EAAE,iBADH;AAENC,MAAAA,SAAS,EAAE,cAFL;AAGNC,MAAAA,QAAQ,EAAE;AAHJ,KADG;AAMXC,IAAAA,IAAI,EAAE;AACJC,MAAAA,MAAM,EAAE;AAAEC,QAAAA,IAAI,EAAE,EAAR;AAAYC,QAAAA,IAAI,EAAE;AAAlB,OADJ;AAEJC,MAAAA,IAAI,EACF,g7DAHE;AAIJC,MAAAA,KAAK,EACH,g7DALE;AAMJC,MAAAA,MAAM,EAAE;AANJ;AANK,GAAb;AAgBA,QAAMC,EAAE,GAAG,OAAX;AApBa,4BAqBUZ,IAAI,CAACK,IAAL,CAAUC,MArBpB;AAAA,QAqBLC,IArBK,qBAqBLA,IArBK;AAAA,QAqBCC,IArBD,qBAqBCA,IArBD;AAAA,qBAsBwCR,IAAI,CAACK,IAtB7C;AAAA,QAsBCQ,IAtBD,cAsBLJ,IAtBK;AAAA,QAsBcK,KAtBd,cAsBOJ,KAtBP;AAAA,QAsB6BK,MAtB7B,cAsBqBJ,MAtBrB;AAuBb,QAAMK,aAAa,GAAG;AACpBC,IAAAA,KAAK,EAAE;AACLJ,MAAAA,IAAI,EAAE,SADD;AAELK,MAAAA,GAAG,EAAE,CAFA;AAGLC,MAAAA,GAAG,EAAE;AAHA,KADa;AAMpBC,IAAAA,KAAK,EAAE;AACLP,MAAAA,IAAI,EAAE,MADD;AAELK,MAAAA,GAAG,EAAE,CAFA;AAGLC,MAAAA,GAAG,EAAE;AAHA,KANa;AAWpBE,IAAAA,KAAK,EAAE;AACLR,MAAAA,IAAI,EAAE,qCADD;AAELK,MAAAA,GAAG,EAAE,EAFA;AAGLC,MAAAA,GAAG,EAAE;AAHA;AAXa,GAAtB;;AAkBA,QAAMG,gBAAgB,GAAGC,KAAK,IAAI;AAChC;AACA,QAAIC,QAAQ,GAAGD,KAAK,CAACE,GAArB;;AACA,QAAIF,KAAK,CAACG,OAAN,IAAiB,CAAjB,IAAsBH,KAAK,CAACG,OAAN,GAAgB,EAA1C,EAA8C;AAC5CF,MAAAA,QAAQ,GAAI,QAAOA,QAAQ,CAACG,WAAT,EAAuB,OAA1C;AACD;;AACD,UAAMC,QAAQ,GAAGjC,iBAAiB,CAACiB,EAAD,EAAKJ,IAAL,CAAlC;AACA,UAAMqB,UAAU,GAAG;AACjB5B,MAAAA,MAAM,EAAE;AACNC,QAAAA,OAAO,EAAE,iBADH;AAENC,QAAAA,SAAS,EAAE,cAFL;AAGNC,QAAAA,QAAQ,EAAE,gBAHJ,CAIN;;AAJM,OADS;AAOjBC,MAAAA,IAAI,EAAE;AACJyB,QAAAA,KAAK,EAAE,WADH;AAEJC,QAAAA,QAAQ,EAAEP,QAFN;AAGJb,QAAAA,MAAM,EAAG,GAAEiB,QAAQ,CAACV,GAAI,IAAGU,QAAQ,CAACT,GAAI;AAHpC;AAPW,KAAnB;AAcAjC,IAAAA,KAAK,CAAC;AACJ8C,MAAAA,MAAM,EAAE,MADJ;AAEJC,MAAAA,GAAG,EAAE,gCAFD;AAGJjC,MAAAA,IAAI,EAAEkC,IAAI,CAACC,SAAL,CAAeN,UAAf,CAHF;AAIJO,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB;AAJL,KAAD,CAAL,CAMGC,IANH,CAMQC,QAAQ,IAAI;AAChB;AACA,YAAMtC,IAAI,GAAGsC,QAAQ,CAACtC,IAAT,CAAcK,IAA3B;AAEAhB,MAAAA,cAAc,CAACuB,EAAD,EAAKZ,IAAI,CAACS,IAAV,CAAd;AACAnB,MAAAA,aAAa,CAACsB,EAAD,EAAKZ,IAAI,CAACS,IAAV,EAAgBT,IAAI,CAACU,KAArB,CAAb;AACAlB,MAAAA,cAAc,CAACoB,EAAD,EAAKZ,IAAI,CAACW,MAAV,CAAd;AAEA,YAAM4B,MAAM,GAAGvC,IAAI,CAACwC,MAApB;AACA,UAAIC,SAAS,GAAG,IAAhB;AAEA,YAAMC,KAAK,GAAGnD,cAAc,CAACS,IAAI,CAACW,MAAN,CAA5B;AACA4B,MAAAA,MAAM,CAACI,OAAP,CAAeC,CAAC,IAAI;AAClB,YAAIC,IAAI,CAACC,GAAL,CAASF,CAAC,CAACG,MAAF,GAAWH,CAAC,CAACI,QAAtB,MAAoC,CAAxC,EAA2C;AACzC,cACEN,KAAK,CAACvB,GAAN,IAAayB,CAAC,CAACK,QAAf,IACAP,KAAK,CAACvB,GAAN,IAAayB,CAAC,CAACM,MADf,IAEAN,CAAC,CAACI,QAAF,KAAeN,KAAK,CAACxB,GAHvB,EAIE;AACAuB,YAAAA,SAAS,GAAGG,CAAZ;AACD;AACF;AACF,OAVD;AAYA,YAAMO,cAAc,GAAG1D,gBAAgB,CACrCgD,SAAS,CAACO,QAD2B,EAErCP,SAAS,CAACQ,QAF2B,CAAvC;AAIA,YAAMG,YAAY,GAAG3D,gBAAgB,CACnCgD,SAAS,CAACM,MADyB,EAEnCN,SAAS,CAACS,MAFyB,CAArC;AAKAxD,MAAAA,iBAAiB,CAACkB,EAAD,EAAKuC,cAAL,EAAqBC,YAArB,CAAjB;AACD,KAxCH,EAyCGC,KAzCH,CAyCSf,QAAQ,IAAI;AACjB;AACAgB,MAAAA,OAAO,CAACC,GAAR,CAAa,aAAYjB,QAAS,EAAlC;AACD,KA5CH;AA6CD,GAlED;;AAoEA,QAAMkB,gBAAgB,GAAGjC,KAAK,IAAI;AAChC+B,IAAAA,OAAO,CAACC,GAAR,CAAa,gBAAehC,KAAK,CAACkC,IAAK,gBAAvC;;AACA,QAAIlC,KAAK,CAACG,OAAN,KAAkB,CAAlB,IAAwBH,KAAK,CAACG,OAAN,GAAgB,GAAhB,IAAuBH,KAAK,CAACG,OAAN,KAAkB,GAArE,EAA2E;AACzEH,MAAAA,KAAK,CAACmC,cAAN;AACD;;AAED,UAAMzB,GAAG,GAAG,KAAK0B,KAAL,CAAW1B,GAAvB;AACA,QAAIT,QAAQ,GAAGD,KAAK,CAACE,GAArB;AACA,UAAMG,QAAQ,GAAGjC,iBAAiB,CAACiB,EAAD,EAAKJ,IAAL,CAAlC;;AACA,QAAIe,KAAK,CAACG,OAAN,IAAiB,CAAjB,IAAsBH,KAAK,CAACG,OAAN,GAAgB,EAA1C,EAA8C;AAC5CF,MAAAA,QAAQ,GAAI,QAAOA,QAAQ,CAACG,WAAT,EAAuB,OAA1C;AACD;;AACD,UAAME,UAAU,GAAG;AACjB5B,MAAAA,MAAM,EAAE;AACNC,QAAAA,OAAO,EAAE,iBADH;AAENC,QAAAA,SAAS,EAAE,cAFL;AAGNC,QAAAA,QAAQ,EAAE,gBAHJ,CAIN;;AAJM,OADS;AAOjBC,MAAAA,IAAI,EAAE;AACJyB,QAAAA,KAAK,EAAE,SADH;AAEJC,QAAAA,QAAQ,EAAEP,QAFN;AAGJb,QAAAA,MAAM,EAAG,GAAEiB,QAAQ,CAACV,GAAI,IAAGU,QAAQ,CAACT,GAAI;AAHpC;AAPW,KAAnB;AAcAjC,IAAAA,KAAK,CAAC;AACJ8C,MAAAA,MAAM,EAAE,MADJ;AAEJC,MAAAA,GAFI;AAGJjC,MAAAA,IAAI,EAAEkC,IAAI,CAACC,SAAL,CAAeN,UAAf,CAHF;AAIJO,MAAAA,OAAO,EAAE;AAAE,wBAAgB;AAAlB;AAJL,KAAD,CAAL,CAMGC,IANH,CAMQC,QAAQ,IAAI;AAChB;AACA,YAAMtC,IAAI,GAAGsC,QAAQ,CAACtC,IAAT,CAAcK,IAA3B;AAEAhB,MAAAA,cAAc,CAACuB,EAAD,EAAKZ,IAAI,CAACS,IAAV,CAAd;AACAnB,MAAAA,aAAa,CAACsB,EAAD,EAAKZ,IAAI,CAACS,IAAV,EAAgBT,IAAI,CAACU,KAArB,CAAb;AACAlB,MAAAA,cAAc,CAACoB,EAAD,EAAKZ,IAAI,CAACW,MAAV,CAAd;AAEA,WAAKiD,uBAAL,CAA6BhD,EAA7B;AACD,KAfH,EAgBGyC,KAhBH,CAgBSf,QAAQ,IAAI;AACjB;AACAgB,MAAAA,OAAO,CAACC,GAAR,CAAa,aAAYjB,QAAS,EAAlC;AACD,KAnBH;AAoBD,GA9CD;;AAgDA,QAAMuB,gBAAgB,GAAGtC,KAAK,IAAI;AAChC+B,IAAAA,OAAO,CAACC,GAAR,CAAa,gBAAehC,KAAK,CAACkC,IAAK,gBAAvC;AACA,UAAMK,cAAc,GAAGnE,iBAAiB,CAACiB,EAAD,EAAKJ,IAAL,CAAxC;AACA,UAAMuD,YAAY,GAAGnE,eAAe,CAACgB,EAAD,EAAKJ,IAAL,CAApC;AAEA,UAAMwD,IAAI,GAAG,OAAb,CALgC,CAMhC;;AACA,QAAIA,IAAI,KAAK,MAAb,EAAqB;AACnB,YAAMb,cAAc,GAAG1D,gBAAgB,CAACqE,cAAc,CAAC5C,GAAhB,EAAqB,CAArB,CAAhB,GAA0C,CAAjE;AACA,YAAMkC,YAAY,GAAG3D,gBAAgB,CAACsE,YAAY,CAAC7C,GAAd,EAAmBV,IAAnB,CAAhB,GAA2C,CAAhE;AAEAd,MAAAA,iBAAiB,CAACkB,EAAD,EAAKuC,cAAL,EAAqBC,YAArB,CAAjB;AACD;AACF,GAbD;;AAeA,SACE;AAAK,IAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KASE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IATF,EAUE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,oBAAC,aAAD;AACE,IAAA,EAAE,EAAExC,EADN;AAEE,IAAA,GAAG,EAAEd,KAFP;AAGE,IAAA,IAAI,EAAES,IAHR;AAIE,IAAA,IAAI,EAAEC,IAJR;AAKE,IAAA,IAAI,EAAEK,IALR;AAME,IAAA,KAAK,EAAEC,KANT;AAOE,IAAA,MAAM,EAAEC,MAPV;AAQE,IAAA,SAAS,EAAEC,aARb;AASE,IAAA,aAAa,EAAEM,gBATjB;AAUE,IAAA,SAAS,EAAEkC,gBAVb;AAWE,IAAA,SAAS,EAAEK,gBAXb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAcE;AAAQ,IAAA,OAAO,EAAE,MAAM/D,KAAK,CAACmE,OAAN,CAAcC,gBAAd,CAA+BlD,aAA/B,CAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAdF,EAiBE;AACE,IAAA,OAAO,EAAE,MAAM;AACbsC,MAAAA,OAAO,CAACC,GAAR,CAAYzD,KAAK,CAACmE,OAAN,CAAcE,gBAAd,EAAZ;AACD,KAHH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAjBF,EAwBE;AAAQ,IAAA,OAAO,EAAE,MAAMrE,KAAK,CAACmE,OAAN,CAAcG,kBAAd,EAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAxBF,EA2BE;AACE,IAAA,OAAO,EAAE,MAAM;AACb,YAAMC,SAAS,GAAGvE,KAAK,CAACmE,OAAN,CAAcK,gBAAd,EAAlB;AACAxE,MAAAA,KAAK,CAACmE,OAAN,CAAcM,YAAd,CAA2BxE,KAA3B,EAAkCsE,SAAlC;AACD,KAJH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cA3BF,EAmCE;AACE,IAAA,OAAO,EAAE,MAAM;AACbf,MAAAA,OAAO,CAACC,GAAR,CAAYzD,KAAK,CAACmE,OAAN,CAAcO,YAAd,CAA2BzE,KAA3B,CAAZ;AACD,KAHH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAnCF,EA0CE;AACE,IAAA,OAAO,EAAE,MAAM;AACbD,MAAAA,KAAK,CAACmE,OAAN,CAAcQ,cAAd,CAA6B1E,KAA7B;AACD,KAHH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBA1CF,CAVF,CADF;AA+DD;;AAED,eAAeF,GAAf","sourcesContent":["import React, { useRef } from \"react\";\nimport Axios from \"axios\";\n\nimport Emulator from \"./components/Emulator\";\nimport ScreenMapping from \"./components/ScreenMapping\";\n\nimport {\n  setAs400Screen,\n  setAs400Style,\n  getAS400Cursor,\n  setAS400Cursor,\n  getIndexByRowCol,\n  setSelectionRange,\n  getStartSelection,\n  getEndSelection\n} from \"./components/Emulator/controler\";\n\nfunction App() {\n  const smRef = useRef();\n  const MARK1 = \"mark-1\";\n\n  const data = {\n    HEADER: {\n      tokenId: \"EWI112233445566\",\n      requestId: \"ABC123456789\",\n      deviceId: \"UUID9988776655\"\n    },\n    DATA: {\n      screen: { rows: 24, cols: 80 },\n      Text:\n        \"                                   Sign On                                      \\n                                               System  . . . . . :   S101CD3M   \\n                                               Subsystem . . . . :   QINTER     \\n                                               Display . . . . . :   QPADEV003R \\n                                                                                \\n                User  . . . . . . . . . . . . . .                               \\n                Password  . . . . . . . . . . . .                               \\n                Program/procedure . . . . . . . .                               \\n                Menu  . . . . . . . . . . . . . .                               \\n                Current library . . . . . . . . .                               \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                                                                \\n                                        (C) COPYRIGHT IBM CORP. 1980, 2005.     \",\n      Style:\n        \".................................RRRRRRRRRRRRR..................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n.........................................................UUUUUUUUUU.............\\n.........................................................HHHHHHHHHH.............\\n.........................................................UUUUUUUUUU.............\\n.........................................................UUUUUUUUUU.............\\n.........................................................UUUUUUUUUU.............\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\\n................................................................................\",\n      Cursor: \"5,53\"\n    }\n  };\n\n  const id = \"flow2\";\n  const { rows, cols } = data.DATA.screen;\n  const { Text: text, Style: style, Cursor: cursor } = data.DATA;\n  const highlightList = {\n    mark1: {\n      text: \"Sign On\",\n      row: 1,\n      col: 36\n    },\n    mark2: {\n      text: \"User\",\n      row: 6,\n      col: 17\n    },\n    mark3: {\n      text: \"(C) COPYRIGHT IBM CORP. 1980, 2005.\",\n      row: 24,\n      col: 41\n    }\n  };\n\n  const onDbllickHandler = event => {\n    // console.log(`| ========== ${event.type} ========== |`);\n    let eventKey = event.key;\n    if (event.keyCode >= 8 && event.keyCode < 48) {\n      eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n    }\n    const selected = getStartSelection(id, cols);\n    const dataForApi = {\n      HEADER: {\n        tokenId: \"EWI112233445566\",\n        requestId: \"ABC123456789\",\n        deviceId: \"UUID9988776655\"\n        // requestCount: this.resultCount\n      },\n      DATA: {\n        Event: \"SELECTION\",\n        KeyValue: eventKey,\n        Cursor: `${selected.row},${selected.col}`\n      }\n    };\n\n    Axios({\n      method: \"post\",\n      url: \"http://localhost:8085/emulator\",\n      data: JSON.stringify(dataForApi),\n      headers: { \"Content-Type\": \"application/json\" }\n    })\n      .then(response => {\n        // handle success\n        const data = response.data.DATA;\n\n        setAs400Screen(id, data.Text);\n        setAs400Style(id, data.Text, data.Style);\n        setAS400Cursor(id, data.Cursor);\n\n        const fields = data.Fields;\n        let selection = null;\n\n        const index = getAS400Cursor(data.Cursor);\n        fields.forEach(f => {\n          if (Math.abs(f.EndRow - f.StartRow) === 0) {\n            if (\n              index.col >= f.StartCol &&\n              index.col <= f.EndCol &&\n              f.StartRow === index.row\n            ) {\n              selection = f;\n            }\n          }\n        });\n\n        const selectionStart = getIndexByRowCol(\n          selection.StartRow,\n          selection.StartCol\n        );\n        const selectionEnd = getIndexByRowCol(\n          selection.EndRow,\n          selection.EndCol\n        );\n\n        setSelectionRange(id, selectionStart, selectionEnd);\n      })\n      .catch(response => {\n        // handle error\n        console.log(`response: ${response}`);\n      });\n  };\n\n  const onMouseUpHandler = event => {\n    console.log(`| ========== ${event.type} ========== | `);\n    if (event.keyCode === 9 || (event.keyCode > 111 && event.keyCode !== 123)) {\n      event.preventDefault();\n    }\n\n    const url = this.state.url;\n    let eventKey = event.key;\n    const selected = getStartSelection(id, cols);\n    if (event.keyCode >= 8 && event.keyCode < 48) {\n      eventKey = `[' + ${eventKey.toLowerCase()} + ']`;\n    }\n    const dataForApi = {\n      HEADER: {\n        tokenId: \"EWI112233445566\",\n        requestId: \"ABC123456789\",\n        deviceId: \"UUID9988776655\"\n        // requestCount: this.resultCount\n      },\n      DATA: {\n        Event: \"KEYDOWN\",\n        KeyValue: eventKey,\n        Cursor: `${selected.row},${selected.col}`\n      }\n    };\n\n    Axios({\n      method: \"post\",\n      url,\n      data: JSON.stringify(dataForApi),\n      headers: { \"Content-Type\": \"application/json\" }\n    })\n      .then(response => {\n        // handle success\n        const data = response.data.DATA;\n\n        setAs400Screen(id, data.Text);\n        setAs400Style(id, data.Text, data.Style);\n        setAS400Cursor(id, data.Cursor);\n\n        this.clearAllMarkChackString(id);\n      })\n      .catch(response => {\n        // handle error\n        console.log(`response: ${response}`);\n      });\n  };\n\n  const onKeyDownHandler = event => {\n    console.log(`| ========== ${event.type} ========== | `);\n    const startSelection = getStartSelection(id, cols);\n    const endSelection = getEndSelection(id, cols);\n\n    const flag = \"field\";\n    // const flag = 'list';\n    if (flag === \"list\") {\n      const selectionStart = getIndexByRowCol(startSelection.row, 0) + 1;\n      const selectionEnd = getIndexByRowCol(endSelection.row, cols) + 2;\n\n      setSelectionRange(id, selectionStart, selectionEnd);\n    }\n  };\n\n  return (\n    <div className=\"App\">\n      {/* <Emulator\n        id=\"flow\"\n        rows={rows}\n        cols={cols}\n        text={text}\n        style={style}\n        cursor={cursor}\n      /> */}\n      <br />\n      <div>\n        <ScreenMapping\n          id={id}\n          ref={smRef}\n          rows={rows}\n          cols={cols}\n          text={text}\n          style={style}\n          cursor={cursor}\n          highlight={highlightList}\n          onDoubleClick={onDbllickHandler}\n          onMouseUp={onMouseUpHandler}\n          onKeyDown={onKeyDownHandler}\n        />\n        <button onClick={() => smRef.current.setHighlightList(highlightList)}>\n          highlight\n        </button>\n        <button\n          onClick={() => {\n            console.log(smRef.current.getHighlightList());\n          }}\n        >\n          get mark\n        </button>\n        <button onClick={() => smRef.current.clearHighlightList()}>\n          clear\n        </button>\n        <button\n          onClick={() => {\n            const highlight = smRef.current.getLastSelection();\n            smRef.current.setHighlight(MARK1, highlight);\n          }}\n        >\n          mark 1\n        </button>\n        <button\n          onClick={() => {\n            console.log(smRef.current.getHighlight(MARK1));\n          }}\n        >\n          get mark 1\n        </button>\n        <button\n          onClick={() => {\n            smRef.current.clearHighlight(MARK1);\n          }}\n        >\n          clear mark 1\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}